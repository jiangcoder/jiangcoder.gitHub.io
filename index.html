<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8">
<title>永远年轻，永远热泪盈眶</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    
    <meta name="description" content="Just for fun !">
<meta property="og:type" content="website">
<meta property="og:title" content="永远年轻，永远热泪盈眶">
<meta property="og:url" content="https://jiangcoder.github.io/index.html">
<meta property="og:site_name" content="永远年轻，永远热泪盈眶">
<meta property="og:description" content="Just for fun !">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="姜涛">
<meta name="twitter:card" content="summary">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?7c6f6b686c79ef47c3578297d99b3305";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
<meta name="generator" content="Hexo 4.2.0"></head>
<!--<body class="is-3-column">-->
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">


                <!--update by thank: 修改logo方式-->
                <!--<img src="/images/maotouying.svg" alt="蜗居年华" height="28">-->
                <img src="https://avatars2.githubusercontent.com/u/8393744?s=400&u=6ff7deb174a4e34b1b1b6291aaccbdc23eb40b14&v=4" alt="永远年轻，永远热泪盈眶" height="28">
                <span style="font-size: 16px; display: inline-block; vertical-align: top; font-weight: 600;"></span>
                <!--
            % if (has_config('logo.text') && get_config('logo.text')) { 
                <span style="font-size: 16px; display: inline-block; vertical-align: top; font-weight: 600;">%= get_config('logo.text') %</span>
                %= get_config('logo.text') %
            % } else { %
                <img src="%- url_for(get_config('logo')) %" alt="%= get_config('title') %" height="28">
            % } %
                -->
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">首页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">


                    <div class="box01">
                        <input type="text" id="tip" placeholder="You Know, for Search~">
                        <i class="search_icon"></i>
                    </div>

                    <!--<i class="fas fa-search"></i>-->

                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-10-19T09:55:27.763Z">2020-10-19</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-10-19 17:55:27&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-10-19T09:55:27.763Z">2020-10-19</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                
                <span class="level-item has-text-grey">
                    
                    
                    41 分钟 读完 (大约 6168 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/10/19/Redis%E9%9D%A2%E8%AF%95%E9%A2%98/">Redis面试题</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><p>1、什么是Redis?<br>Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。</p>
<p>Redis 与其他 key - value 缓存产品有以下三个特点：<br>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。Redis支持数据的备份，即master-slave模式的数据备份。</p>
<p>Redis 优势<br>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p>
<p>Redis与其他key-value存储有什么不同？<br>Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。</p>
<p>Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，因为数据量不能大于硬件内存。在内存数据库方面的另一个优点是，相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</p>
<p>2、Redis的数据类型？<br>答：Redis支持五种数据类型：string（字符串），hash（哈希），list（列表），set（集合）及zsetsorted set：有序集合)。</p>
<p>我们实际项目中比较常用的是string，hash如果你是Redis中高级用户，还需要加上下面几种数据结构HyperLogLog、Geo、Pub/Sub。</p>
<p>如果你说还玩过Redis Module，像BloomFilter，RedisSearch，Redis-ML，面试官得眼睛就开始发亮了。</p>
<p>3、使用Redis有哪些好处？<br>1、速度快，因为数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O1)</p>
<p>2、支持丰富数据类型，支持string，list，set，Zset，hash等</p>
<p>3、支持事务，操作都是原子性，所谓的原子性就是对数据的更改要么全部执行，要么全部不执行</p>
<p>4、丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除</p>
<p>4、Redis相比Memcached有哪些优势？<br>1、Memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类<br>2、Redis的速度比Memcached快很<br>3、Redis可以持久化其数据</p>
<p>5、Memcache与Redis的区别都有哪些？<br>1、存储方式 Memecache把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小。Redis有部份存在硬盘上，这样能保证数据的持久性。</p>
<p>2、数据支持类型 Memcache对数据类型支持相对简单。Redis有复杂的数据类型。</p>
<p>3、使用底层模型不同 它们之间底层实现方式 以及与客户端之间通信的应用协议不一样。Redis直接自己构建了VM 机制 ，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求。</p>
<p>6、Redis是单进程单线程的？<br>答：Redis是单进程单线程的，redis利用队列技术将并发访问变为串行访问，消除了传统数据库串行控制的开销。</p>
<p>7、一个字符串类型的值能存储最大容量是多少？<br>答：512M</p>
<p>8、Redis的持久化机制是什么？各自的优缺点？<br>Redis提供两种持久化机制RDB和AOF机制:<br>1、RDBRedis DataBase)持久化方式：是指用数据集快照的方式半持久化模式)记录redis数据库的所有键值对,在某个时间点将数据写入一个临时文件，持久化结束后，用这个临时文件替换上次持久化的文件，达到数据恢复。</p>
<p>优点：<br>1、只有一个文件dump.rdb，方便持久化。</p>
<p>2、容灾性好，一个文件可以保存到安全的磁盘。</p>
<p>3、性能最大化，fork子进程来完成写操作，让主进程继续处理命令，所以是IO最大化。使用单独子进程来进行持久化，主进程不会进行任何IO操作，保证了redis的高性能) 4.相对于数据集大时，比AOF的启动效率更高。</p>
<p>缺点：<br>1、数据安全性低。RDB是间隔一段时间进行持久化，如果持久化之间redis发生故障，会发生数据丢失。所以这种方式更适合数据要求不严谨的时候)</p>
<p>2、AOFAppend-only file)持久化方式：是指所有的命令行记录以redis命令请求协议的格式完全持久化存储)保存为aof文件。</p>
<p>优点：<br>1、数据安全，aof持久化可以配置appendfsync属性，有always，每进行一次命令操作就记录到aof文件中一次。</p>
<p>2、通过append模式写文件，即使中途服务器宕机，可以通过redis-check-aof工具解决数据一致性问题。</p>
<p>3、AOF机制的rewrite模式。AOF文件没被rewrite之前（文件过大时会对命令进行合并重写），可以删除其中的某些命令（比如误操作的flushall）)</p>
<p>缺点：<br>1、AOF文件比RDB文件大，且恢复速度慢。2、数据集大的时候，比rdb启动效率低。</p>
<p>9、Redis常见性能问题和解决方案：<br>1、Master最好不要写内存快照，如果Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务 2、如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一 3、为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网 4、尽量避免在压力很大的主库上增加从 5、主从复制不要用图状结构，用单向链表结构更为稳定，即：Master <- Slave1 <- Slave2 <- Slave3…这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。</p>
<p>10、redis过期键的删除策略？<br>1、定时删除:在设置键的过期时间的同时，创建一个定时器timer). 让定时器在键的过期时间来临时，立即执行对键的删除操作。</p>
<p>2、惰性删除:放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键;如果没有过期，就返回该键。</p>
<p>3、定期删除:每隔一段时间程序就对数据库进行一次检查，删除里面的过期键。至于要删除多少过期键，以及要检查多少个数据库，则由算法决定。</p>
<p>11、Redis的回收策略（淘汰策略）?<br>volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰</p>
<p>volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰</p>
<p>volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰</p>
<p>allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰</p>
<p>allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰</p>
<p>no-enviction（驱逐）：禁止驱逐数据</p>
<p>注意这里的6种机制，volatile和allkeys规定了是对已设置过期时间的数据集淘汰数据还是从全部数据集淘汰数据，后面的lru、ttl以及random是三种不同的淘汰策略，再加上一种no-enviction永不回收的策略。</p>
<p>使用策略规则：</p>
<p>1、如果数据呈现幂律分布，也就是一部分数据访问频率高，一部分数据访问频率低，则使用allkeys-lru</p>
<p>2、如果数据呈现平等分布，也就是所有的数据访问频率都相同，则使用allkeys-random</p>
<p>12、为什么Redis需要把所有数据放到内存中？<br>答：Redis为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以redis具有快速和数据持久化的特征。如果不将数据放在内存中，磁盘I/O速度为严重影响redis的性能。在内存越来越便宜的今天，redis将会越来越受欢迎。如果设置了最大使用的内存，则数据已有记录数达到内存限值后不能继续插入新值。</p>
<p>13、Redis的同步机制了解么？<br>答：Redis可以使用主从同步，从从同步。第一次同步时，主节点做一次bgsave，并同时将后续修改操作记录到内存buffer，待完成后将rdb文件全量同步到复制节点，复制节点接受完成后将rdb镜像加载到内存。加载完成后，再通知主节点将期间修改的操作记录同步到复制节点进行重放就完成了同步过程。</p>
<p>14、Pipeline有什么好处，为什么要用pipeline？<br>答：可以将多次IO往返的时间缩减为一次，前提是pipeline执行的指令之间没有因果相关性。使用redis-benchmark进行压测的时候可以发现影响redis的QPS峰值的一个重要因素是pipeline批次指令的数目。</p>
<p>15、是否使用过Redis集群，集群的原理是什么？<br>1)、Redis Sentinal着眼于高可用，在master宕机时会自动将slave提升为master，继续提供服务。</p>
<p>2)、Redis Cluster着眼于扩展性，在单个redis内存不足时，使用Cluster进行分片存储。</p>
<p>16、Redis集群方案什么情况下会导致整个集群不可用？<br>答：有A，B，C三个节点的集群,在没有复制模型的情况下,如果节点B失败了，那么整个集群就会以为缺少5501-11000这个范围的槽而不可用。</p>
<p>17、Redis支持的Java客户端都有哪些？官方推荐用哪个？<br>答：Redisson、Jedis、lettuce等等，官方推荐使用Redisson。</p>
<p>18、Jedis与Redisson对比有什么优缺点？<br>答：Jedis是Redis的Java实现的客户端，其API提供了比较全面的Redis命令的支持；Redisson实现了分布式和可扩展的Java数据结构，和Jedis相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等Redis特性。Redisson的宗旨是促进使用者对Redis的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上。</p>
<p>19、Redis如何设置密码及验证密码？<br>设置密码：config set requirepass 123456</p>
<p>授权密码：auth 123456</p>
<p>20、说说Redis哈希槽的概念？<br>答：Redis集群没有使用一致性hash,而是引入了哈希槽的概念，Redis集群有16384个哈希槽，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。</p>
<p>21、Redis集群的主从复制模型是怎样的？<br>答：为了使在部分节点失败或者大部分节点无法通信的情况下集群仍然可用，所以集群使用了主从复制模型,每个节点都会有N-1个复制品.</p>
<p>22、Redis集群会有写操作丢失吗？为什么？<br>答：Redis并不能保证数据的强一致性，这意味这在实际中集群在特定的条件下可能会丢失写操作。</p>
<p>23、Redis集群之间是如何复制的？<br>答：异步复制</p>
<p>24、Redis集群最大节点个数是多少？<br>答：16384个。</p>
<p>25、Redis集群如何选择数据库？<br>答：Redis集群目前无法做数据库选择，默认在0数据库。</p>
<p>26、怎么测试Redis的连通性？<br>答：使用ping命令。</p>
<p>27、怎么理解Redis事务？<br>答：</p>
<p>1）事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p>
<p>2）事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>
<p>28、Redis事务相关的命令有哪几个？<br>答：MULTI、EXEC、DISCARD、WATCH</p>
<p>29、Redis key的过期时间和永久有效分别怎么设置？<br>答：EXPIRE和PERSIST命令。</p>
<p>30、Redis如何做内存优化？<br>答：尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是应该把这个用户的所有信息存储到一张散列表里面.</p>
<p>31、Redis回收进程如何工作的？<br>答：一个客户端运行了新的命令，添加了新的数据。Redi检查内存使用情况，如果大于maxmemory的限制, 则根据设定好的策略进行回收。一个新的命令被执行，等等。所以我们不断地穿越内存限制的边界，通过不断达到边界然后不断地回收回到边界以下。如果一个命令的结果导致大量内存被使用（例如很大的集合的交集保存到一个新的键），不用多久内存限制就会被这个内存使用量超越。</p>
<p>32、都有哪些办法可以降低Redis的内存使用情况呢？<br>答：如果你使用的是32位的Redis实例，可以好好利用Hash,list,sorted set,set等集合类型数据，因为通常情况下很多小的Key-Value可以用更紧凑的方式存放到一起。</p>
<p>33、Redis的内存用完了会发生什么？<br>答：如果达到设置的上限，Redis的写命令会返回错误信息（但是读命令还可以正常返回。）或者你可以将Redis当缓存来使用配置淘汰机制，当Redis达到内存上限时会冲刷掉旧的内容。</p>
<p>34、一个Redis实例最多能存放多少的keys？List、Set、Sorted Set他们最多能存放多少元素？<br>答：理论上Redis可以处理多达232的keys，并且在实际中进行了测试，每个实例至少存放了2亿5千万的keys。我们正在测试一些较大的值。任何list、set、和sorted set都可以放232个元素。换句话说，Redis的存储极限是系统中的可用内存值。</p>
<p>35、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？<br>答：Redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。</p>
<p>相关知识：Redis提供6种数据淘汰策略：</p>
<p>volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰</p>
<p>volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰</p>
<p>volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰</p>
<p>allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰</p>
<p>allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰</p>
<p>no-enviction（驱逐）：禁止驱逐数据</p>
<p>36、Redis最适合的场景？<br>1、会话缓存（Session Cache）<br>最常用的一种使用Redis的情景是会话缓存（session cache）。用Redis缓存会话比其他存储（如Memcached）的优势在于：Redis提供持久化。当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？幸运的是，随着 Redis 这些年的改进，很容易找到怎么恰当的使用Redis来缓存会话的文档。甚至广为人知的商业平台Magento也提供Redis的插件。</p>
<p>2、全页缓存（FPC）<br>除基本的会话token之外，Redis还提供很简便的FPC平台。回到一致性问题，即使重启了Redis实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似PHP本地FPC。再次以Magento为例，Magento提供一个插件来使用Redis作为全页缓存后端。此外，对WordPress的用户来说，Pantheon有一个非常好的插件 wp-redis，这个插件能帮助你以最快速度加载你曾浏览过的页面。</p>
<p>3、队列<br>Reids在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得Redis能作为一个很好的消息队列平台来使用。Redis作为队列使用的操作，就类似于本地程序语言（如Python）对 list 的 push/pop 操作。如果你快速的在Google中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用Redis创建非常好的后端工具，以满足各种队列需求。例如，Celery有一个后台就是使用Redis作为broker，你可以从这里去查看。</p>
<p>4，排行榜/计数器<br>Redis在内存中对数字进行递增或递减的操作实现的非常好。集合（Set）和有序集合（Sorted Set）也使得我们在执行这些操作的时候变的非常简单，Redis只是正好提供了这两种数据结构。所以，我们要从排序集合中获取到排名最靠前的10个用户–我们称之为“userscores”，我们只需要像下面一样执行即可：当然，这是假定你是根据你用户的分数做递增的排序。如果你想返回用户及用户的分数，你需要这样执行：ZRANGE userscores 0 10 WITHSCORES Agora Games就是一个很好的例子，用Ruby实现的，它的排行榜就是使用Redis来存储数据的，你可以在这里看到。</p>
<p>5、发布/订阅<br>最后（但肯定不是最不重要的）是Redis的发布/订阅功能。发布/订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用Redis的发布/订阅功能来建立聊天系统！</p>
<p>37、假如Redis里面有1亿个key，其中有10w个key是以某个固定的已知的前缀开头的，如果将它们全部找出来？<br>答：使用keys指令可以扫出指定模式的key列表。</p>
<p>对方接着追问：如果这个redis正在给线上的业务提供服务，那使用keys指令会有什么问题？</p>
<p>这个时候你要回答redis关键的一个特性：redis的单线程的。keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用scan指令，scan指令可以无阻塞的提取出指定模式的key列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用keys指令长。</p>
<p>38、如果有大量的key需要设置同一时间过期，一般需要注意什么？<br>答：如果大量的key过期时间设置的过于集中，到过期的那个时间点，redis可能会出现短暂的卡顿现象。一般需要在时间上加一个随机值，使得过期时间分散一些。</p>
<p>39、使用过Redis做异步队列么，你是怎么用的？<br>答：一般使用list结构作为队列，rpush生产消息，lpop消费消息。当lpop没有消息的时候，要适当sleep一会再重试。</p>
<p>如果对方追问可不可以不用sleep呢？<br>list还有个指令叫blpop，在没有消息的时候，它会阻塞住直到消息到来。如果对方追问能不能生产一次消费多次呢？使用pub/sub主题订阅者模式，可以实现1:N的消息队列。</p>
<p>如果对方追问pub/sub有什么缺点？<br>在消费者下线的情况下，生产的消息会丢失，得使用专业的消息队列如RabbitMQ等。</p>
<p>如果对方追问redis如何实现延时队列？<br>我估计现在你很想把面试官一棒打死如果你手上有一根棒球棍的话，怎么问的这么详细。但是你很克制，然后神态自若的回答道：使用sortedset，拿时间戳作为score，消息内容作为key调用zadd来生产消息，消费者用zrangebyscore指令获取N秒之前的数据轮询进行处理。到这里，面试官暗地里已经对你竖起了大拇指。但是他不知道的是此刻你却竖起了中指，在椅子背后。</p>
<p>40、使用过Redis分布式锁么，它是什么回事？<br>先拿setnx来争抢锁，抢到之后，再用expire给锁加一个过期时间防止锁忘记了释放。</p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-10-19T09:38:03.451Z">2020-10-19</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-10-19 17:38:03&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-10-19T09:38:03.451Z">2020-10-19</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 449 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/10/19/raft%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/">raft一致性协议</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><p>1.raft是一个实现了解决分布式一致性问题的协议</p>
<p>2.分布式环境下的每个节点有三种状态：</p>
<p>　　follower（跟随者）<br>　　candidate（候选人）<br>　　leader（领导者）</p>
<p>3.所有的节点开始都是follower状态</p>
<p>   一旦他们不能检测到leader就能成为candidate</p>
<p>   candidate会请求其他节点投票，得到大多是节点的投票就会成为leader，这个过程叫做Leader Election</p>
<p>4.节点的每个改变都会增加节点的日志条目，提交之后leader会复制日志条目到从节点上，在大多数从节点成功增加日志条目之后，提交成功，leader值更新，leader通知从节点已经更新成功，从节点更新数据，这个过程叫做Log Replication。</p>
<p>5.Leader Election</p>
<p>Raft有两个timeout设置来控制选举<br>第一个是election timeout<br>　　election timeout指的是follower等待成为candidate的时间，在150ms到300ms之间<br>　　election timeout一个follower成为一个开始一个election term<br>　　投票给自己，请求其他节点投票，在得到大多数节点投票之后，重置election timeout，成为leader<br>第二个是HearBeat timeout<br>　　Append Entries 在HeartBeat timeout时发送<br>6.Log Replication<br> Log Replicaiton是通过HeartBeat timeout发送Append Entries来完成的</p>
<p>　　客户端发送更新请求</p>
<p>　　leader增加日志条目</p>
<p>　　在下个HeartBeat时，日志变化发给follower</p>
<p>　　在大多数从节点成功之后，leader提交数据并响应客户端</p>
<p>　　下次HeartBeat Timeout之后，从节点数据更新</p>
<p>7，如何选主过程，可以参考学习该动画<br><a href="https://raft.github.io/raftscope/index.html" target="_blank" rel="noopener">https://raft.github.io/raftscope/index.html</a></p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/" class="image is-7by1">
            <img class="thumbnail" src="/logo/elasticsearch.jpg" alt="Elasticsearch 之Doc Values">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-05-11T13:10:14.655Z">2020-05-11</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-05-11 21:10:14&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-05-11T13:10:14.655Z">2020-05-11</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/elasticsearch/">elasticsearch</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 分钟 读完 (大约 1703 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/">Elasticsearch 之Doc Values</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><h2 id="一，Elasticsearch之keyword和text"><a href="#一，Elasticsearch之keyword和text" class="headerlink" title="一，Elasticsearch之keyword和text"></a>一，Elasticsearch之keyword和text</h2><p>Elasticsearch 5.0.0 版本之后 将string拆分成两个新的类型: text和keyword.</p>
<p>Keyword类型:</p>
<p>用于存储邮箱号码、手机号码、主机名、状态码、邮政编码、标签、年龄、性别等数据。<br>用于筛选数据(例如: select * from x where status=’open’)、排序、聚合(统计)。<br>直接将完整的文本保存到倒排索引中。<br>Text类型:</p>
<p>用于存储全文搜索数据, 例如: 邮箱内容、地址、代码块、博客文章内容等。<br>默认结合standard analyzer(标准解析器)对文本进行分词、倒排索引。<br>默认结合标准分析器进行词命中、词频相关度打分。</p>
<h2 id="二，Elasticsearch之Doc-Values"><a href="#二，Elasticsearch之Doc-Values" class="headerlink" title="二，Elasticsearch之Doc Values"></a>二，Elasticsearch之Doc Values</h2><p>正排索引：是以文档的ID为关键字，表中记录文档中每个字段的值信息，主要场景是通过查询id来把整条文档拿出来；</p>
<p>Doc Values数据结构如下：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Doc      Terms</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">Doc_1 | brown, dog, fox, jumped, lazy, over, quick, the</span><br><span class="line">Doc_2 | brown, dogs, foxes, in, lazy, leap, over, quick, summer</span><br><span class="line">Doc_3 | dog, dogs, fox, jumped, over, quick, the</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure>

<p>倒排索引：以字或词为关键字进行索引，表中关键字所对应的记录项记录了出现这个字或词的所有文档；</p>
<p>倒排索引数据结构如下：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Term      Doc_1   Doc_2   Doc_3</span><br><span class="line">------------------------------------</span><br><span class="line">brown   |   X   |   X   |</span><br><span class="line">dog     |   X   |       |   X</span><br><span class="line">dogs    |       |   X   |   X</span><br><span class="line">fox     |   X   |       |   X</span><br><span class="line">foxes   |       |   X   |</span><br><span class="line">in      |       |   X   |</span><br><span class="line">jumped  |   X   |       |   X</span><br><span class="line">lazy    |   X   |   X   |</span><br><span class="line">leap    |       |   X   |</span><br><span class="line">over    |   X   |   X   |   X</span><br><span class="line">quick   |   X   |   X   |   X</span><br><span class="line">summer  |       |   X   |</span><br><span class="line">the     |   X   |       |   X</span><br><span class="line">------------------------------------</span><br></pre></td></tr></tbody></table></figure>

<p>正排索引广泛应用在聚合、排序、访问字段值的脚本，父子关系处理（参见 父-子关系文档 ）等方面；</p>
<h2 id="三，Doc-Values-启用"><a href="#三，Doc-Values-启用" class="headerlink" title="三，Doc Values 启用"></a>三，Doc Values 启用</h2><p>Doc Values 是在索引时与 倒排索引 同时生成。也就是说 Doc Values 和 倒排索引 一样，基于 Segement 生成并且是不可变的。同时 Doc Values 和 倒排索引 一样序列化到磁盘，这样对性能和扩展性有很大帮助。</p>
<p>Doc Values 通过序列化把数据结构持久化到磁盘，我们可以充分利用操作系统的内存，而不是 JVM 的 Heap 。 当 working set 远小于系统的可用内存，系统会自动将 Doc Values 驻留在内存中，使得其读写十分快速；不过，当其远大于可用内存时，系统会根据需要从磁盘读取 Doc Values，然后选择性放到分页缓存中。很显然，这样性能会比在内存中差很多，但是它的大小就不再局限于服务器的内存了。如果是使用 JVM 的 Heap 来实现那么只能是因为 OutOfMemory 导致程序崩溃了。  </p>
<p>因为 Doc Values 不是由 JVM 来管理，所以 Elasticsearch 实例可以配置一个很小的 JVM Heap，这样给系统留出来更多的内存。同时更小的 Heap 可以让 JVM 更加快速和高效的回收。</p>
<p>之前，我们会建议分配机器内存的 50% 来给 JVM Heap。但是对于 Doc Values，这样可能不是最合适的方案了。 以 64gb 内存的机器为例，可能给 Heap 分配 4-16gb 的内存更合适，而不是 32gb。</p>
<p>有关更详细的讨论，查看 堆内存:大小和交换.</p>
<p>Doc Values 默认对所有字段启用，除了 analyzed strings。也就是说所有的数字、地理坐标、日期、IP 和不分析（ not_analyzed ）字符类型都会默认开启。</p>
<h2 id="四，Doc-Values-实现细节"><a href="#四，Doc-Values-实现细节" class="headerlink" title="四，Doc Values 实现细节"></a>四，Doc Values 实现细节</h2><p>从广义来说，Doc Values 本质上是一个序列化的 列式存储 。 正如我们上一节所讨论的，列式存储 适用于聚合、排序、脚本等操作。</p>
<p>而且，这种存储方式也非常便于压缩，特别是数字类型。这样可以减少磁盘空间并且提高访问速度。现代 CPU 的处理速度要比磁盘快几个数量级（尽管即将到来的 NVMe 驱动器正在迅速缩小差距）。所以我们必须减少直接存磁盘读取数据的大小，尽管需要额外消耗 CPU 运算用来进行解压。</p>
<p>要了解它如何压缩数据的，来看一组数字类型的 Doc Values：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Doc      Terms</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">Doc_1 | <span class="hljs-number">100</span></span><br><span class="line">Doc_2 | <span class="hljs-number">1000</span></span><br><span class="line">Doc_3 | <span class="hljs-number">1500</span></span><br><span class="line">Doc_4 | <span class="hljs-number">1200</span></span><br><span class="line">Doc_5 | <span class="hljs-number">300</span></span><br><span class="line">Doc_6 | <span class="hljs-number">1900</span></span><br><span class="line">Doc_7 | <span class="hljs-number">4200</span></span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure>

<p>按列布局意味着我们有一个连续的数据块： [100,1000,1500,1200,300,1900,4200] 。因为我们已经知道他们都是数字（而不是像文档或行中看到的异构集合），所以我们可以使用统一的偏移来将他们紧紧排列。</p>
<p>而且，针对这样的数字有很多种压缩技巧。你会注意到这里每个数字都是 100 的倍数，Doc Values 会检测一个段里面的所有数值，并使用一个 最大公约数 ，方便做进一步的数据压缩。</p>
<p>如果我们保存 100 作为此段的除数，我们可以对每个数字都除以 100，然后得到： [1,10,15,12,3,19,42] 。现在这些数字变小了，只需要很少的位就可以存储下，也减少了磁盘存放的大小。</p>
<p>Doc Values 在压缩过程中使用如下技巧。它会按依次检测以下压缩模式:</p>
<p>如果所有的数值各不相同（或缺失），设置一个标记并记录这些值<br>如果这些值小于 256，将使用一个简单的编码表<br>如果这些值大于 256，检测是否存在一个最大公约数<br>如果没有存在最大公约数，从最小的数值开始，统一计算偏移量进行编码<br>你会发现这些压缩模式不是传统的通用的压缩方式，比如 DEFLATE 或是 LZ4。 因为列式存储的结构是严格且良好定义的，我们可以通过使用专门的模式来达到比通用压缩算法（如 LZ4 ）更高的压缩效果。</p>
<h2 id="五，Doc-Values-使用注意的问题"><a href="#五，Doc-Values-使用注意的问题" class="headerlink" title="五，Doc Values 使用注意的问题"></a>五，Doc Values 使用注意的问题</h2><p>除数字外，keyword类型默认也开启了Doc Values ，此时必须注意size必须<= 32766，如果超出，则回提示如下错误</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: DocValuesField <span class="hljs-string">"xxx"</span> is too large, must be <= <span class="hljs-number">32766</span></span><br></pre></td></tr></tbody></table></figure>

<p>象形文字字符(中文、韩文、日文): 10922 个字符(算法是: 32766 / 3).<br>Literal字符(印度语、俄文): 16383 个字符(算法是: 32766 / 2).<br>ASCII字符(a-zA-Z0-9以及~!@#$等特殊字符): 32766个字符(算法是: 32766).</p>
<p>通过关闭Doc Values特性，可以解决该问题</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-string">"content"</span>: {</span><br><span class="line">  <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>,</span><br><span class="line">  <span class="hljs-string">"index"</span>: <span class="hljs-string">"no"</span>,</span><br><span class="line">  <span class="hljs-string">"store"</span>: <span class="hljs-string">"true"</span>,</span><br><span class="line">  <span class="hljs-string">"doc_values"</span>: <span class="hljs-string">"false"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/" class="image is-7by1">
            <img class="thumbnail" src="/logo/kafka.jpg" alt="Kafka节点平滑迁移">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-04-23T12:31:28.532Z">2020-04-23</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-04-23 20:31:28&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-04-23T12:31:28.532Z">2020-04-23</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/kafka/">kafka</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 426 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/">Kafka节点平滑迁移</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><h2 id="一，查看所有的topic"><a href="#一，查看所有的topic" class="headerlink" title="一，查看所有的topic"></a>一，查看所有的topic</h2><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper ip:port --list</span><br></pre></td></tr></tbody></table></figure>

<h2 id="二，将topic组装为JSON格式"><a href="#二，将topic组装为JSON格式" class="headerlink" title="二，将topic组装为JSON格式"></a>二，将topic组装为JSON格式</h2><p>kafka后台脚本只支持如下JSON格式节点迁移</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="hljs-string">"topics"</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="hljs-string">"topic"</span>: <span class="hljs-string">"plat_order_core_dubbo_access_topic"</span></span><br><span class="line">    }  ],</span><br><span class="line">  <span class="hljs-string">"version"</span>: <span class="hljs-number">1</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>生成该格式代码，可参考使用如下Java代码</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="hljs-keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="hljs-keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="hljs-keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topic2JsonUtil</span> </span>{</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{</span><br><span class="line">        List<String> topicList = readFileAsListFromJarPath(<span class="hljs-string">"topic.txt"</span>);</span><br><span class="line">        List<JSONObject> topicJsonList = Lists.newArrayList();</span><br><span class="line">        topicList.forEach(topic -> {</span><br><span class="line">            JSONObject topicJson = <span class="hljs-keyword">new</span> JSONObject();</span><br><span class="line">            topicJson.put(<span class="hljs-string">"topic"</span>, topic);</span><br><span class="line">            topicJsonList.add(topicJson);</span><br><span class="line">        });</span><br><span class="line">        JSONObject resultJson = <span class="hljs-keyword">new</span> JSONObject();</span><br><span class="line">        resultJson.put(<span class="hljs-string">"topics"</span>, topicJsonList);</span><br><span class="line">        System.out.println(resultJson);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List<String> <span class="hljs-title">readFileAsListFromJarPath</span><span class="hljs-params">(String fileName)</span> </span>{</span><br><span class="line">        List<String> result = <span class="hljs-keyword">new</span> ArrayList<>();</span><br><span class="line">        <span class="hljs-keyword">try</span> {</span><br><span class="line">            InputStream inputStream = Topic2JsonUtil<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">getClassLoader</span>().<span class="hljs-title">getResourceAsStream</span>(<span class="hljs-title">fileName</span>)</span>;</span><br><span class="line">            BufferedReader reader = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(inputStream, StandardCharsets.UTF_8));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(line)) {</span><br><span class="line">                    result.add(line);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            reader.close();</span><br><span class="line">        } <span class="hljs-keyword">catch</span> (Exception e) {</span><br><span class="line">            LogUtil.ROOT.error(<span class="hljs-string">""</span>, e);</span><br><span class="line">        }</span><br><span class="line">        StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="hljs-keyword">if</span> (result.size() != <span class="hljs-number">0</span>) {</span><br><span class="line">            result.forEach(builder::append);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="三，生成迁移计划"><a href="#三，生成迁移计划" class="headerlink" title="三，生成迁移计划"></a>三，生成迁移计划</h2><p>使用如下命令生成迁移计划<br>如下示例代表将topic所有的节点数据重新路由到4、5、6节点上，并将迁移计划输出到plan-move.json文件中</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-reassign-partitions.sh --zookeeper ip:port --topics-to-move-json-file  topics-to-move.json  --broker-list  <span class="hljs-string">"4,5,6"</span>  --generate  > plan-move.json</span><br></pre></td></tr></tbody></table></figure>
<p>生成的计划格式化后如下：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Current partition replica assignment</span><br><span class="line">{</span><br><span class="line">	<span class="hljs-string">"version"</span>: <span class="hljs-number">1</span>,</span><br><span class="line">	<span class="hljs-string">"partitions"</span>: [{</span><br><span class="line">		<span class="hljs-string">"topic"</span>: <span class="hljs-string">"erp_java_topic"</span>,</span><br><span class="line">		<span class="hljs-string">"partition"</span>: <span class="hljs-number">9</span>,</span><br><span class="line">		<span class="hljs-string">"replicas"</span>: [<span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>],</span><br><span class="line">		<span class="hljs-string">"log_dirs"</span>: [<span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>]</span><br><span class="line">	}]</span><br><span class="line">}</span><br><span class="line">Proposed partition reassignment configuration</span><br><span class="line">{</span><br><span class="line">	<span class="hljs-string">"version"</span>: <span class="hljs-number">1</span>,</span><br><span class="line">	<span class="hljs-string">"partitions"</span>: [{</span><br><span class="line">		<span class="hljs-string">"topic"</span>: <span class="hljs-string">"erp_java_topic"</span>,</span><br><span class="line">		<span class="hljs-string">"partition"</span>: <span class="hljs-number">9</span>,</span><br><span class="line">		<span class="hljs-string">"replicas"</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>],</span><br><span class="line">		<span class="hljs-string">"log_dirs"</span>: [<span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>, <span class="hljs-string">"any"</span>]</span><br><span class="line">	}]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>保留迁移计划JSON，即下面的JSON内容；</p>
<h2 id="四，执行迁移计划"><a href="#四，执行迁移计划" class="headerlink" title="四，执行迁移计划"></a>四，执行迁移计划</h2><p>执行迁移计划</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-reassign-partitions.sh --zookeeper ip:port --reassignment-json-file plan-move.json --execute</span><br></pre></td></tr></tbody></table></figure>
<p>查看迁移进度</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-reassign-partitions.sh --zookeeper ip:port --reassignment-json-file plan-move.json --verify</span><br></pre></td></tr></tbody></table></figure>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/" class="image is-7by1">
            <img class="thumbnail" src="/logo/qiye.jpeg" alt="Linux系统之用户态、内核态">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-28T09:14:32.266Z">2020-03-28</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-28 17:14:32&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-28T09:14:32.266Z">2020-03-28</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/linux/">linux</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1216 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/">Linux系统之用户态、内核态</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><p>#什么是内核态、用户态？<br>内核态：cpu可以访问内存的所有数据，包括外围设备，例如硬盘，网卡，cpu也可以将自己从一个程序切换到另一个程序。<br>用户态：只能受限的访问内存，且不允许访问外围设备，占用cpu的能力被剥夺，cpu资源可以被其他程序获取。</p>
<p>#为什么要有用户态和内核态？<br>由于需要限制不同的程序之间的访问能力, 防止他们获取别的程序的内存数据, 或者获取外围设备的数据, 并发送到网络,<br>CPU划分出两个权限等级 – 用户态和内核态。</p>
<p>#用户态与内核态的切换</p>
<p>所有用户程序都是运行在用户态的, 但是有时候程序确实需要做一些内核态的事情, 例如从硬盘读取数据, 或者从键盘获取输入等. 而唯一可以做这些事情的就是操作系统, 所以此时程序就需要先操作系统请求以程序的名义来执行这些操作.<br>这时需要一个这样的机制: 用户态程序切换到内核态, 但是不能控制在内核态中执行的指令<br>这种机制叫系统调用, 在CPU中的实现称之为陷阱指令(Trap Instruction)<br>他们的工作流程如下:<br>用户态程序将一些数据值放在寄存器中, 或者使用参数创建一个堆栈(stack frame), 以此表明需要操作系统提供的服务.<br>用户态程序执行陷阱指令<br>CPU切换到内核态, 并跳到位于内存指定位置的指令, 这些指令是操作系统的一部分, 他们具有内存保护, 不可被用户态程序访问<br>这些指令称之为陷阱(trap)或者系统调用处理器(system call handler). 他们会读取程序放入内存的数据参数, 并执行程序请求的服务<br>系统调用完成后, 操作系统会重置CPU为用户态并返回系统调用的结果<br>当一个任务（进程）执行系统调用而陷入内核代码中执行时，我们就称进程处于内核运行态（或简称为内核态）。此时处理器处于特权级最高的（0级）内核代码中执行。当进程处于内核态时，执行的内核代码会使用当前进程的内核栈。每个进程都有自己的内核栈。当进程在执行用户自己的代码时，则称其处于用户运行态（用户态）。即此时处理器在特权级最低的（3级）用户代码中运行。当正在执行用户程序而突然被中断程序中断时，此时用户程序也可以象征性地称为处于进程的内核态。因为中断处理程序将使用当前进程的内核栈。这与处于内核态的进程的状态有些类似。 </p>
<p>内核态与用户态是操作系统的两种运行级别,跟intel cpu没有必然的联系, intel cpu提供Ring0-Ring3三种级别的运行模式，Ring0级别最高，Ring3最低。Linux使用了Ring3级别运行用户态，Ring0作为 内核态，没有使用Ring1和Ring2。Ring3状态不能访问Ring0的地址空间，包括代码和数据。Linux进程的4GB地址空间，3G-4G部 分大家是共享的，是内核态的地址空间，这里存放在整个内核的代码和所有的内核模块，以及内核所维护的数据。用户运行一个程序，该程序所创建的进程开始是运 行在用户态的，如果要执行文件操作，网络数据发送等操作，必须通过write，send等系统调用，这些系统调用会调用内核中的代码来完成操作，这时，必 须切换到Ring0，然后进入3GB-4GB中的内核地址空间去执行这些代码完成操作，完成后，切换回Ring3，回到用户态。这样，用户态的程序就不能 随意操作内核地址空间，具有一定的安全保护作用。<br>至于说保护模式，是说通过内存页表操作等机制，保证进程间的地址空间不会互相冲突，一个进程的操作不会修改另一个进程的地址空间中的数据。</p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/27/Elasticsearch%E5%AE%9A%E5%88%B6%E5%8C%96%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" class="image is-7by1">
            <img class="thumbnail" src="/logo/elasticsearch.jpg" alt="Elasticsearch定制化插件开发">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-27T14:00:39.449Z">2020-03-27</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-27 22:00:39&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-27T14:00:39.449Z">2020-03-27</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/elasticsearch/">elasticsearch</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 读完 (大约 796 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/27/Elasticsearch%E5%AE%9A%E5%88%B6%E5%8C%96%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/">Elasticsearch定制化插件开发</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><p>一，一般的插件开发方式：<br>    按照官网教程，每次都得打包、替换、重启，这是一个很不方便的过程，固然可以通过testCase来做debug，但是所见即所得的编码习惯，直接上手debug，才是最高效的方式。<br>   介绍插件开发的博客何其多，个人私以为都没有get到G点，其实深入研究下elasticsearch源码，fix 这个问题并不难，下面希望通过这篇文章帮助到大家。<br>二，elasticsearch插件的加载机制<br>①：Node节点启动过程，Elasticsearch.java会调用Bootstrap.java中的init函数。</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(...)</span>  </span>{</span><br><span class="line">        ...</span><br><span class="line">        INSTANCE = <span class="hljs-keyword">new</span> Bootstrap();</span><br><span class="line">        INSTANCE.setup(<span class="hljs-keyword">true</span>, environment);</span><br><span class="line">        ...</span><br><span class="line">        INSTANCE.start();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>②：Node节点通过setup方法进行实例化。</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> addShutdownHook, Environment environment)</span> <span class="hljs-keyword">throws</span> BootstrapException </span>{</span><br><span class="line">         </span><br><span class="line">    node = <span class="hljs-keyword">new</span> Node(environment) {</span><br><span class="line"> </span><br><span class="line">     ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>③：Node.java类中会包含各类的service服务，其中包括PluginsService服务。在实例化PluginsService服务时会传参</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">environment.pluginsFile(),classpathPlugins等参数。而pluginsFile()即是elasticsearch所指定的plugin目录，elasticsearch会扫描该路径下所有的插件，并加载进来。</span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(Environment environment)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">this</span>(environment, Collections.emptyList());</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">Node</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Environment environment, Collection<Class<? extends Plugin>> classpathPlugins)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">this</span>.pluginsService = <span class="hljs-keyword">new</span> PluginsService(tmpSettings, environment.modulesFile(), environment.pluginsFile(), classpathPlugins);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>④：classpathPlugins参数介绍：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">this</span>(environment, Collections.emptyList());</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>在elasticsearch源码中，这个参数Collection<Class<? extends Plugin>> classpathPlugins一直都是空集合。<br>没有任何地方注入修改该参数。elasticsearch不但会扫描插件所在路径中的插件，同样也会加载classpathPlugins中所指定的插件，只不过问题是elasticsearch没有给我们提供相应的参数！！！！<br>三，如何更优雅的开发开发插件<br>    接上一段小节④，我们只要利用classpathPlugins该参数，就可以在elasticsearch源码环境中进行debug了！！！<br>    我的实现思路如下，通过继承Node.java，并重写Node类的构造方法，然后在bootstrap中直接实例化该子类，便可以通过elasticsearch直接bug 插件源码了。<br>   下面贴出我的实现代码，供大家参考：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> org.elasticsearch.Version;</span><br><span class="line"><span class="hljs-keyword">import</span> org.elasticsearch.env.Environment;</span><br><span class="line"><span class="hljs-keyword">import</span> org.elasticsearch.node.Node;</span><br><span class="line"><span class="hljs-keyword">import</span> org.elasticsearch.plugins.Plugin;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddedNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Node</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">private</span> Version version;</span><br><span class="line">  <span class="hljs-keyword">private</span> Collection<Class<? extends Plugin>> plugins;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmbeddedNode</span><span class="hljs-params">(Environment environment, Version version, Collection<Class<? extends Plugin>> classpathPlugins)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>(environment,  classpathPlugins);</span><br><span class="line">    <span class="hljs-keyword">this</span>.version = version;</span><br><span class="line">    <span class="hljs-keyword">this</span>.plugins = classpathPlugins;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">public</span> Collection<Class<? extends Plugin>> getPlugins() {</span><br><span class="line">    <span class="hljs-keyword">return</span> plugins;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> Version <span class="hljs-title">getVersion</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> version;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> addShutdownHook, Environment environment)</span> <span class="hljs-keyword">throws</span> BootstrapException </span>{</span><br><span class="line">      .....</span><br><span class="line">       <span class="hljs-comment">//注释Node初始化源码</span></span><br><span class="line">       <span class="hljs-comment">/* node = new Node(environment) {</span></span><br><span class="line"><span class="hljs-comment">            @Override</span></span><br><span class="line"><span class="hljs-comment">            protected void validateNodeBeforeAcceptingRequests(</span></span><br><span class="line"><span class="hljs-comment">                final Settings settings,</span></span><br><span class="line"><span class="hljs-comment">                final BoundTransportAddress boundTransportAddress, List<BootstrapCheck> checks) throws NodeValidationException {</span></span><br><span class="line"><span class="hljs-comment">                BootstrapChecks.check(settings, boundTransportAddress, checks);</span></span><br><span class="line"><span class="hljs-comment">            }</span></span><br><span class="line"><span class="hljs-comment">        };*/</span></span><br><span class="line"></span><br><span class="line">        Collection plugins = <span class="hljs-keyword">new</span> ArrayList<>();</span><br><span class="line">        Collections.addAll(plugins,   AnalysisIkPlugin<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">HelloPlugin</span>.<span class="hljs-title">class</span>, <span class="hljs-title">AnalysisMMsegPlugin</span>.<span class="hljs-title">class</span>)</span>;<span class="hljs-comment">//, ,AnalysisMMsegPlugin.class</span></span><br><span class="line">        node = <span class="hljs-keyword">new</span> EmbeddedNode(environment, Version.CURRENT, plugins) {</span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">validateNodeBeforeAcceptingRequests</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Settings settings, <span class="hljs-keyword">final</span> BoundTransportAddress boundTransportAddress, List<BootstrapCheck> checks)</span> <span class="hljs-keyword">throws</span> NodeValidationException </span>{</span><br><span class="line">                BootstrapChecks.check(settings, boundTransportAddress, checks);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>四，部署插件相关的注意事项：<br>     有关插件开发的详细配置，es插件的种类，在此不再赘述，具体可参考官方文档，更权威，更直接。<br>下面贴个图，本人在elasticsearch中同时整合了多个插件，以供学习研究时用，直接debug，个人感觉十分不错。</p>
<p><img alt src="/logo/plugin.jpg"></p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/27/Java%E4%B9%8BBuffer/" class="image is-7by1">
            <img class="thumbnail" src="/logo/java.jpg" alt="Java之Buffer">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-27T05:54:09.968Z">2020-03-27</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-27 13:54:09&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-27T05:54:09.968Z">2020-03-27</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/java/">java</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 读完 (大约 596 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/27/Java%E4%B9%8BBuffer/">Java之Buffer</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><h2 id="一，Buffer概念"><a href="#一，Buffer概念" class="headerlink" title="一，Buffer概念"></a>一，Buffer概念</h2><p>Buffer 类是 java.nio 的构造基础。<br>一个 Buffer 对象是固定数量的数据的容器，其作用是一个存储器，或者分段运输区.<br>每个非布尔原始数据类型都有一个缓冲区类.<br>子类有</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer</span><br><span class="line">CharBuffer</span><br><span class="line">IntBuffer</span><br><span class="line">LongBuffer</span><br><span class="line">DoubleBuffer</span><br><span class="line">FloatBuffer</span><br><span class="line">ShortBuffer</span><br></pre></td></tr></tbody></table></figure>
<h2 id="二，缓存区的四个属性"><a href="#二，缓存区的四个属性" class="headerlink" title="二，缓存区的四个属性"></a>二，缓存区的四个属性</h2><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mark = -<span class="hljs-number">1</span>;<span class="hljs-comment">//一个备忘位置。标记在设定前是未定义的(undefined)。使用场景是，假设缓冲区中有 10 个元素，position 目前的位置为 2(也就是如果get的话是第三个元素)，现在只想发送 6 - 10 之间的缓冲数据，此时我们可以 buffer.mark(buffer.position())，即把当前的 position 记入 mark 中，然后 buffer.postion(6)，此时发送给 channel 的数据就是 6 - 10 的数据。发送完后，我们可以调用 buffer.reset() 使得 position = mark，因此这里的 mark 只是用于临时记录一下位置用的</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> position = <span class="hljs-number">0</span>;<span class="hljs-comment">//下一个要被读或写的元素的索引。位置会自动由相应的 get() 和 put() 函数更新。 这里需要注意的是positon的位置是从0开始的</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> limit;<span class="hljs-comment">//缓冲区的第一个不能被读或写的元素。缓冲创建时，limit 的值等于 capacity 的值。假设 capacity = 1024，我们在程序中设置了 limit = 512，说明，Buffer 的容量为 1024，但是从 512 之后既不能读也不能写，因此可以理解成，Buffer 的实际可用大小为 512</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<span class="hljs-comment">//缓冲区能够容纳的数据元素的最大数量。这一容量在缓冲区创建时被设定，并且永远不能被改变。</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="三，flip"><a href="#三，flip" class="headerlink" title="三，flip"></a>三，flip</h2><p>flip() :写模式转到读模式<br>clear()或者compact():重新从Buffer中读取数据<br>such as :</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateBuffer</span> </span>{</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args[])</span> </span>{</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);</span><br><span class="line"></span><br><span class="line">        buffer.put((<span class="hljs-keyword">byte</span>) <span class="hljs-string">'a'</span>);</span><br><span class="line">        buffer.put((<span class="hljs-keyword">byte</span>) <span class="hljs-string">'b'</span>);</span><br><span class="line">        buffer.put((<span class="hljs-keyword">byte</span>) <span class="hljs-string">'c'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//调用flip之后，读写指针指到缓存头部，并且设置了最多只能读出之前写入的数据长度(而不是整个缓存的容量大小)</span></span><br><span class="line">        buffer.flip();</span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//a</span></span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//b</span></span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//c</span></span><br><span class="line">        <span class="hljs-comment">//重新从Buffer中读取数据</span></span><br><span class="line">        buffer.compact();</span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//a</span></span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//b</span></span><br><span class="line">        System.out.println((<span class="hljs-keyword">char</span>) buffer.get());<span class="hljs-comment">//c        </span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/22/%E3%80%8A%E5%8F%AF%E5%A4%8D%E5%88%B6%E7%9A%84%E9%A2%86%E5%AF%BC%E5%8A%9B%E3%80%8B%E8%AF%BB%E5%90%8E%E6%9C%89%E6%84%9F/" class="image is-7by1">
            <img class="thumbnail" src="/logo/ciqi.jpeg" alt="《可复制的领导力》读后有感">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-22T11:49:02.614Z">2020-03-22</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-22 19:49:02&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-22T11:49:02.614Z">2020-03-22</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/%E4%BA%BA%E6%96%87/">人文</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1120 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/22/%E3%80%8A%E5%8F%AF%E5%A4%8D%E5%88%B6%E7%9A%84%E9%A2%86%E5%AF%BC%E5%8A%9B%E3%80%8B%E8%AF%BB%E5%90%8E%E6%9C%89%E6%84%9F/">《可复制的领导力》读后有感</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>   2020年以来，一直想读一本关于管理类的书籍，前中央电视台主持人樊登创办了《樊登读书会》，仅用4年时间，付费会员人数便突破300万，发展势头非常良好。<br>   樊登老师的《可复制的领导力》在京东商城管理类书籍排名第一，抱着高山仰止的心态，选择了这本书，<br>进行拜读学习。</p>
<h2 id="《樊登读书会》火爆带来的思考"><a href="#《樊登读书会》火爆带来的思考" class="headerlink" title="《樊登读书会》火爆带来的思考"></a>《樊登读书会》火爆带来的思考</h2><p>   在我高中的时候，学校来了一位中国最年轻的演讲家，在学校的大操场慷慨激昂，励志事迹娓娓道来，音响里重复播放着《感恩的心》，最后领着我们宣誓，<br>让我们很多同学，尤其是女同学哭的稀里哗啦，最后很多人买了演讲家100多元的书。<br>  《樊登读书会》能够为那些没有时间阅读、不知道阅读哪些书和阅读效率低下的人，每年吸收50本书的精华。<br>旨在让更多的中国人爱上阅读，通过传播知识不断提升自己，造福社会。<br>我恰好同学在参加了《樊登读书会》，故有了解一些，其大概每年收取365元会费，加入会属于班级以及小组，营造一种共同学习的氛围。<br>读书的重要性不必自说，樊登老师是成功者，也毋庸讳言，不过加入这种每年付费的读书会，我个人感觉是非常不必要的，通过阅读其作品，领悟到其思想中精华就好了。</p>
<h2 id="《可复制的领导力》读后有感一"><a href="#《可复制的领导力》读后有感一" class="headerlink" title="《可复制的领导力》读后有感一"></a>《可复制的领导力》读后有感一</h2><p>   樊登老师在该书中总结了一些关于管理的观点<br>   1、领导力就是一个工具包，可习得、可复制、可传递。<br>      感悟：大概类似两千多年前秦朝的陈胜吧，在地头里喊出”王侯将相，宁有种乎”。<br>这本书也想向我们说明，管理能力不是某些人具备的一种天赋，也不是不可意会的艺术，而是人人都可以掌握的一种能力，跟学习语文、数学没什么区别。<br>   2、团队是一只球队，而不是家，需要明确彼此的目标，才能更有效的合作；<br>      感悟：建立一个团队目标，大家一起朝着目标努力。<br>   3、管理者的几个关键步骤。<br>      先建立感情，信任；再激发源动力，培养责任感；努力营造好的团队氛围；以身作则，知行合一； 良好的沟通，客观的反馈。<br>      感悟：总结的很好；</p>
<h2 id="《可复制的领导力》读后有感二"><a href="#《可复制的领导力》读后有感二" class="headerlink" title="《可复制的领导力》读后有感二"></a>《可复制的领导力》读后有感二</h2><p>   管理是一门科学，更是一门艺术。犹如看大豆结出果实。需要有种豆、浇水，施肥，开花，结果等等一系列的过程。<br>管理能力虽说不是天生的，我们需要不断练习即可获得，但是也不要看完樊登老师举的”海底捞、麦当劳”成功小事例，就盲目自信，<br>给自己一种很容易学习到的感觉。<br>   《可复制的执行力》在京东商城管理类书籍排名第一，但在我看来，的确不能算一本好书。跟我看高中时买的演讲家自编的励志故事书味道差不多；<br>一本书，一篇文章到底好不好，大概需要经历岁月的洗涤，历久弥新，给人以启发吧。<br>买书学管理，我个人感觉还是不要看京东上热销的管理学的书了，别抱着太强的功利心了，或许读书更有启发吧；<br>正如：孙子兵法第一句：”兵者，国之大事，死生之地，存亡之道，不可不察也”。孙子兵法流传千年，靠的不是打仗的小诀窍，<br>而是站在民族、国家、军队的一个领导者一个应有的战略高度！</p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/20/Elasticsearch%E8%B4%9F%E8%BD%BD%E9%AB%98%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" class="image is-7by1">
            <img class="thumbnail" src="/logo/elasticsearch.jpg" alt="Elasticsearch负载高问题排查">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-20T13:35:30.731Z">2020-03-20</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-20 21:35:30&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-20T13:35:30.731Z">2020-03-20</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/elasticsearch/">elasticsearch</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 读完 (大约 629 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/20/Elasticsearch%E8%B4%9F%E8%BD%BD%E9%AB%98%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">Elasticsearch负载高问题排查</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><ol>
<li><p>我们Elasticsearch集群近几日负载飙高，排查思路记录如下；</p>
</li>
<li><p>查看日志信息，确定是否存在异常情况</p>
</li>
</ol>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ${ES_HOME}/logs</span><br><span class="line">tail -<span class="hljs-number">100f</span> ES.log</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>频繁Full GC往往会引起负载飙高，故查看ES集群GC 情况，</li>
</ol>
<p>使用命令：</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gcutil <pid> <period> <times></span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200320205733385.png" alt="在这里插入图片描述"><br>近一个多月，服务共Full GC700余次，平均每次Full GC耗时90ms，符合预期，排除Full GC问题导致负载飙高；<br>4. 找到ES中占用CPU的线程ID</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -Hp PID</span><br></pre></td></tr></tbody></table></figure>
<p>如找到ES进程中2291线程较费CPU<br><img src="https://img-blog.csdnimg.cn/20200320210618219.png" alt="在这里插入图片描述"></p>
<ol start="5">
<li>将得到的线程id，转化为16进制</li>
</ol>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf %x <span class="hljs-number">2291</span></span><br><span class="line">输出结果：<span class="hljs-number">8f</span>3</span><br></pre></td></tr></tbody></table></figure>

<ol start="7">
<li>使用jstack分析线程状态<br>jstack命令主要用于调试java程序运行过程中的线程堆栈信息</li>
</ol>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack PID  >> pid.txt</span><br></pre></td></tr></tbody></table></figure>
<p>8.查看pid.txt文件，分析线程对应的堆栈信息<br>由步骤6得到 16进制线程“8f3”</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim pid.txt</span><br><span class="line"><span class="hljs-comment">//查找线程“8f3”对应信息</span></span><br></pre></td></tr></tbody></table></figure>
<p>内容如下</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">"elasticsearch[data-es12][write][T#3]" #94 daemon prio=5 os_prio=0 tid=0x00007f3254017800 nid=0x8f3 waiting for monitor entry [0x00007f2d37a7a000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at org.elasticsearch.index.translog.TranslogWriter.syncUpTo(TranslogWriter.java:<span class="hljs-number">342</span>)</span><br><span class="line">        - waiting to lock <<span class="hljs-number">0x000000055ff5f220</span>> (a java.lang.Object)</span><br><span class="line">        at org.elasticsearch.index.translog.Translog.ensureSynced(Translog.java:<span class="hljs-number">797</span>)</span><br><span class="line">        at org.elasticsearch.index.translog.Translog.ensureSynced(Translog.java:<span class="hljs-number">818</span>)</span><br><span class="line">        at org.elasticsearch.index.engine.InternalEngine.ensureTranslogSynced(InternalEngine.java:<span class="hljs-number">489</span>)</span><br><span class="line">        at org.elasticsearch.index.shard.IndexShard$<span class="hljs-number">5</span>.write(IndexShard.java:<span class="hljs-number">2782</span>)</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.AsyncIOProcessor.processList(AsyncIOProcessor.java:<span class="hljs-number">107</span>)</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.AsyncIOProcessor.drainAndProcess(AsyncIOProcessor.java:<span class="hljs-number">99</span>)</span><br><span class="line">        at org.elasticsearch.common.util.concurrent.AsyncIOProcessor.put(AsyncIOProcessor.java:<span class="hljs-number">82</span>)</span><br><span class="line">        at org.elasticsearch.index.shard.IndexShard.sync(IndexShard.java:<span class="hljs-number">2804</span>)</span><br><span class="line">        at org.elasticsearch.action.support.replication.TransportWriteAction$AsyncAfterWriteAction.run(TransportWriteAction.java:<span class="hljs-number">355</span>)</span><br><span class="line">        at org.elasticsearch.action.support.replication.TransportWriteAction$WritePrimaryResult.<init>(TransportWriteAction.java:<span class="hljs-number">151</span>)</span><br><span class="line">        at</span><br></pre></td></tr></tbody></table></figure>

<p>该线程正处于堵塞状态。</p>
<p>9，原因分析<br>从ES索引数据创建机制说起<br>写请求首先先写到内存一份数据，然后写translog，默认每1秒进行refresh，将索引写入到文件系统；<br>该ES集群是ELK日志查询服务，特点读多写少，我们TB级数据，上千个索引，refresh_interval参数1s，在日志服务中显然不太合适，是时候调整下该参数配置了。</p>
<p>10，参数调整</p>
<figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="hljs-comment">//ip:port/logstash*/_settings PUT</span></span><br><span class="line">{</span><br><span class="line">  <span class="hljs-string">"settings"</span>: {</span><br><span class="line">    <span class="hljs-string">"refresh_interval"</span>: <span class="hljs-string">"5m"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200320212733184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FjbTM2NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>11，问题解决</p>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>








        <div class="card">

        <!--update by thank: 文章详情页面不显示文章图片thumbnail-->
    
    <div class="card-image">
        <a href="/2020/03/20/Git%E5%A6%82%E4%BD%95%E5%9B%9E%E9%80%80%E7%89%88%E6%9C%AC/" class="image is-7by1">
            <img class="thumbnail" src="/logo/github.jpg" alt="Git如何回退版本">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                <!--updated by thank: 列表页显示几年前, 文章页显示具体日期-->
                
                <time class="level-item has-text-grey" datetime="2020-03-20T12:47:07.461Z">2020-03-20</time>
                

                <!--<span style="color: #7a7a7a !important;">2020-03-20 20:47:07&nbsp;&nbsp;&nbsp;</span>-->
                <!--<time class="level-item has-text-grey" datetime="2020-03-20T12:47:07.461Z">2020-03-20</time>-->
                <!--<time class="level-item has-text-grey"  datetime="2019-12-12 22:22:22">2018-12-12 22:22:22</time>-->

                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/git/">git</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 64 个字)
                </span>
                

                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/20/Git%E5%A6%82%E4%BD%95%E5%9B%9E%E9%80%80%E7%89%88%E6%9C%AC/">Git如何回退版本</a>
            
        </h1>

        <div class="content">

            <!--update by thank: 控制首页摘要信息不显示样式(去掉Markdown生成的html标签)-->
            
                <html><head></head><body><ol>
<li><p>首先使用git log查看最近几次提交的版本号，如版本号”0250cd”;</p>
</li>
<li><p>在命令行输入 git reset –hard 0250cd，成功后会提示”head is now at 0250cd”；</p>
</li>
<li><p>git push -f -u origin you_branch,you_branch需要回退的分支名</p>
</li>
</ol>
</body></html>
            

            <!--%- index && post.excerpt ? post.excerpt : post.content %-->
        </div>

        


        
        

        <!--% if (!index && has_config('share.type')) { %-->
<!--        % if (index && has_config('share.type')) { %-->
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="https://avatars2.githubusercontent.com/u/8393744?s=400&amp;u=6ff7deb174a4e34b1b1b6291aaccbdc23eb40b14&amp;v=4" alt="姜涛"
                        style="border-radius: 50%">
                    
                    
                    <p class="is-size-4 is-block">
                        姜涛
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Just for fun
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>北京市海淀区</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        6
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        5
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/jiangcoder" target="_blank" >
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">

            <!--
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/jiangcoder">
                
                <i class="fab fa-github"></i>
                
            </a>
           
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
           
            -->

            <a class="level-item button is-white is-marginless" target="_blank" title="github" href="https://github.com/jiangcoder" name>
                <img src="/images/github.svg" style="width: 20px; height: 20px;">
            </a>
<!--             <a class="level-item button is-white is-marginless" target="_blank" title="gitee" href="https://gitee.com/thank037" name>
                <img src="/images/gitee.svg" style="width: 20px; height: 20px;">
            </a>
            <a class="level-item button is-white is-marginless" target="_blank" title="weibo" href="https://weibo.com/u/2139090054" name>
                <img src="/images/weibo.svg" style="width: 20px; height: 20px;">
            </a> -->
            <a class="level-item button is-white is-marginless" target="_blank" title="email" href="mailto:jiangcoder@163.com" name>
                <img src="/images/email.svg" style="width: 20px; height: 20px;">
            </a>

        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            <img src="/images/links.svg"> &nbsp;

            友情链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://www.zsythink.net" target="_blank">
                    <span class="level-left">
                        <span class="level-item">朱双印个人日志</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.zsythink.net</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/elasticsearch/">
            <span class="level-start">
                <span class="level-item">elasticsearch</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/git/">
            <span class="level-start">
                <span class="level-item">git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/java/">
            <span class="level-start">
                <span class="level-item">java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/kafka/">
            <span class="level-start">
                <span class="level-item">kafka</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/linux/">
            <span class="level-start">
                <span class="level-item">linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E4%BA%BA%E6%96%87/">
            <span class="level-start">
                <span class="level-item">人文</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/elasticsearch/" style="font-size: 20px;">elasticsearch</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/%E4%BA%BA%E6%96%87/" style="font-size: 10px;">人文</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/10/19/Redis%E9%9D%A2%E8%AF%95%E9%A2%98/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis面试题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-19T09:55:27.763Z">2020-10-19</time></div>
                    <a href="/2020/10/19/Redis%E9%9D%A2%E8%AF%95%E9%A2%98/" class="has-link-black-ter is-size-6">Redis面试题</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/10/19/raft%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="raft一致性协议">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-19T09:38:03.451Z">2020-10-19</time></div>
                    <a href="/2020/10/19/raft%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/" class="has-link-black-ter is-size-6">raft一致性协议</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/elasticsearch.jpg" alt="Elasticsearch 之Doc Values">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-11T13:10:14.655Z">2020-05-11</time></div>
                    <a href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/" class="has-link-black-ter is-size-6">Elasticsearch 之Doc Values</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/elasticsearch/">elasticsearch</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/kafka.jpg" alt="Kafka节点平滑迁移">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-23T12:31:28.532Z">2020-04-23</time></div>
                    <a href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/" class="has-link-black-ter is-size-6">Kafka节点平滑迁移</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/kafka/">kafka</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/qiye.jpeg" alt="Linux系统之用户态、内核态">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-28T09:14:32.266Z">2020-03-28</time></div>
                    <a href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/" class="has-link-black-ter is-size-6">Linux系统之用户态、内核态</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/linux/">linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%BA%E6%96%87/">
                        <span class="tag">人文</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/10/19/Redis%E9%9D%A2%E8%AF%95%E9%A2%98/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis面试题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-19T09:55:27.763Z">2020-10-19</time></div>
                    <a href="/2020/10/19/Redis%E9%9D%A2%E8%AF%95%E9%A2%98/" class="has-link-black-ter is-size-6">Redis面试题</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/10/19/raft%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="raft一致性协议">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-19T09:38:03.451Z">2020-10-19</time></div>
                    <a href="/2020/10/19/raft%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/" class="has-link-black-ter is-size-6">raft一致性协议</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/elasticsearch.jpg" alt="Elasticsearch 之Doc Values">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-11T13:10:14.655Z">2020-05-11</time></div>
                    <a href="/2020/05/11/Elasticsearch%E4%B9%8BDoc%20Values/" class="has-link-black-ter is-size-6">Elasticsearch 之Doc Values</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/elasticsearch/">elasticsearch</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/kafka.jpg" alt="Kafka节点平滑迁移">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-23T12:31:28.532Z">2020-04-23</time></div>
                    <a href="/2020/04/23/Kafka%E8%8A%82%E7%82%B9%E5%B9%B3%E6%BB%91%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4/" class="has-link-black-ter is-size-6">Kafka节点平滑迁移</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/kafka/">kafka</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/logo/qiye.jpeg" alt="Linux系统之用户态、内核态">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-28T09:14:32.266Z">2020-03-28</time></div>
                    <a href="/2020/03/28/Linux%E7%B3%BB%E7%BB%9F%E4%B9%8B%E7%94%A8%E6%88%B7%E6%80%81%E3%80%81%E5%86%85%E6%A0%B8%E6%80%81/" class="has-link-black-ter is-size-6">Linux系统之用户态、内核态</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/linux/">linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E4%BA%BA%E6%96%87/">
                        <span class="tag">人文</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <!-- <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/%5Bobject%20Object%5D" alt="永远年轻，永远热泪盈眶" height="28">
                
                </a> -->
                <p class="is-size-7">
                &copy; 2016—2020 姜涛&nbsp;
                由<a href="http://hexo.io/" target="_blank">Hexo</a> 强力驱动
                    <!--& <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>-->
                
                <br>
                <span id="busuanzi_container_site_uv">
                您是第<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/jiangcoder">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="全文搜索站内文章~" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    

    <!--背景线条-->
    <!--<script type="text/javascript" color="0,0,255" opacity='0.7' zIndex="-1" count="99" src="dist/canvas-nest.js"></script>-->
    <!--<script type="text/javascript" color="0,0,255" opacity='0.7' zIndex="-1" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>-->
</body>
</html>